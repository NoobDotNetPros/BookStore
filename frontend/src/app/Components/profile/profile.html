<div class="page-container">
    <div class="breadcrumb">
        <a href="/">Home</a> / <span>Profile</span>
    </div>

    <!-- Loading State -->
    <div class="loading-message" *ngIf="isLoading()">
        <p>Loading your profile...</p>
    </div>

    <!-- Error Message -->
    <div class="error-message" *ngIf="errorMessage()">
        <p>{{ errorMessage() }}</p>
    </div>

    <!-- Success Message -->
    <div class="success-message" *ngIf="successMessage()">
        <p>{{ successMessage() }}</p>
    </div>

    <div class="profile-container" *ngIf="!isLoading()">
        <!-- Personal Details -->
        <div class="section personal-details" [class.editing-mode]="isEditing()">
            <div class="section-header">
                <div class="header-title">
                    <h2>Personal Details</h2>
                    <span class="edit-mode-indicator" *ngIf="isEditing()">(Editing)</span>
                </div>
                <div class="button-group">
                    <button *ngIf="!isEditing()" class="edit-btn" (click)="toggleEdit()">Edit</button>
                    <div class="edit-action-buttons" *ngIf="isEditing()">
                        <button class="save-btn" (click)="saveProfile()">Save</button>
                        <button class="cancel-btn" (click)="toggleEdit()">Cancel</button>
                    </div>
                </div>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" [(ngModel)]="fullName" [disabled]="!isEditing()" placeholder="Enter your full name">
                </div>

                <div class="form-group">
                    <label>Email Id</label>
                    <input type="email" [(ngModel)]="email" [disabled]="!isEditing()" placeholder="Enter your email">
                </div>

                <div class="form-group">
                    <label>Mobile Number</label>
                    <input type="text" [(ngModel)]="phone" [disabled]="!isEditing()" placeholder="Enter your mobile number">
                </div>
            </div>
        </div>

        <!-- Address Details -->
        <div class="section address-details">
            <div class="section-header">
                <h2>Address Details</h2>
                <button class="add-btn" (click)="openAddAddressForm()">Add New Address</button>
            </div>

            <!-- Empty State -->
            <div class="empty-addresses" *ngIf="addresses().length === 0">
                <p>No addresses added yet. Click "Add New Address" to add one.</p>
            </div>

            <div class="address-list" *ngIf="addresses().length > 0">
                <div class="address-item" *ngFor="let addr of addresses(); let i = index">
                    <div class="address-header">
                        <h3>{{ i + 1 }}. {{ getAddressTypeDisplay(addr.type) }}</h3>
                        <div class="address-actions">
                            <button class="edit-link" (click)="openEditAddressForm(addr)">Edit</button>
                            <button class="delete-link" (click)="deleteAddress(addr.id!)">Delete</button>
                        </div>
                    </div>

                    <div class="address-content">
                        <div class="form-group full-width">
                            <label>Address</label>
                            <textarea disabled>{{ addr.address || 'No address provided' }}</textarea>
                        </div>

                        <div class="row">
                            <div class="form-group">
                                <label>City/Town</label>
                                <input type="text" [value]="addr.city || 'N/A'" disabled>
                            </div>
                            <div class="form-group">
                                <label>State</label>
                                <input type="text" [value]="addr.state || 'N/A'" disabled>
                            </div>
                        </div>

                        <div class="type-selection">
                            <label>Type</label>
                            <div class="radios">
                                <label class="radio">
                                    <input type="radio" [name]="'loc-' + (addr.id || i)" [checked]="getAddressTypeDisplay(addr.type) === 'HOME'" disabled> Home
                                </label>
                                <label class="radio">
                                    <input type="radio" [name]="'loc-' + (addr.id || i)" [checked]="getAddressTypeDisplay(addr.type) === 'WORK'" disabled> Work
                                </label>
                                <label class="radio">
                                    <input type="radio" [name]="'loc-' + (addr.id || i)" [checked]="getAddressTypeDisplay(addr.type) === 'OTHER'" disabled> Other
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Address Form Modal -->
    <div class="modal-overlay" *ngIf="showAddressForm()" (click)="closeAddressForm()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h3>{{ isEditingAddress() ? 'Edit Address' : 'Add New Address' }}</h3>
                <button class="close-btn" (click)="closeAddressForm()">&times;</button>
            </div>

            <div class="modal-body">
                <div class="form-group">
                    <label>Address <span class="required">*</span></label>
                    <textarea
                        [(ngModel)]="fullAddress"
                        placeholder="Enter your full address (e.g., House No, Street, Landmark)"
                        rows="3"
                    ></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>City/Town <span class="required">*</span></label>
                        <input type="text" [(ngModel)]="city" placeholder="Enter city">
                    </div>
                    <div class="form-group">
                        <label>State <span class="required">*</span></label>
                        <input type="text" [(ngModel)]="state" placeholder="Enter state">
                    </div>
                </div>

                <div class="form-group">
                    <label>Type</label>
                    <div class="radios">
                        <label class="radio">
                            <input type="radio" name="addressType" value="Home" [(ngModel)]="addressType"> Home
                        </label>
                        <label class="radio">
                            <input type="radio" name="addressType" value="Work" [(ngModel)]="addressType"> Work
                        </label>
                        <label class="radio">
                            <input type="radio" name="addressType" value="Other" [(ngModel)]="addressType"> Other
                        </label>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="cancel-btn" (click)="closeAddressForm()" [disabled]="addressFormLoading()">Cancel</button>
                <button class="save-btn" (click)="saveAddress()" [disabled]="addressFormLoading()">
                    {{ addressFormLoading() ? 'Saving...' : (isEditingAddress() ? 'Update' : 'Add') }}
                </button>
            </div>
        </div>
    </div>
</div>
