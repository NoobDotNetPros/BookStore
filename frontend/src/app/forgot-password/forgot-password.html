<div class="forgot-password-container">
  <div class="forgot-password-card">
    <!-- Step 1: Email Input -->
    <ng-container *ngIf="currentStep === 'email'">
      <h2>Forgot Your Password?</h2>
      <p>Enter your email address and we'll send you an OTP to reset your password.</p>

      <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>
      <div *ngIf="successMessage" class="success-message">{{ successMessage }}</div>

      <form (ngSubmit)="onSubmitEmail()" #emailForm="ngForm">
        <label for="email">Email Id</label>
        <input type="email" id="email" name="email" [(ngModel)]="email" required autocomplete="off" />
        <button type="submit" [disabled]="!emailForm.form.valid || isLoading">
          {{ isLoading ? 'Sending...' : 'Send OTP' }}
        </button>
      </form>
    </ng-container>

    <!-- Step 2: OTP Verification -->
    <ng-container *ngIf="currentStep === 'otp'">
      <h2>Enter OTP</h2>
      <p>We've sent a 6-digit OTP to your email. Please enter it below.</p>

      <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>
      <div *ngIf="successMessage" class="success-message">{{ successMessage }}</div>

      <form (ngSubmit)="onSubmitOtp()" #otpForm="ngForm">
        <label for="otp">OTP</label>
        <input
          type="text"
          id="otp"
          name="otp"
          [(ngModel)]="otp"
          required
          maxlength="6"
          pattern="[0-9]{6}"
          placeholder="Enter 6-digit OTP"
          autocomplete="off"
        />
        <button type="submit" [disabled]="otp.length !== 6 || isLoading">
          {{ isLoading ? 'Verifying...' : 'Verify OTP' }}
        </button>
      </form>

      <div class="resend-section">
        <button
          type="button"
          class="resend-btn"
          (click)="onResendOtp()"
          [disabled]="resendCooldown > 0 || isLoading"
        >
          {{ resendCooldown > 0 ? 'Resend OTP in ' + formatCooldownTime() : 'Resend OTP' }}
        </button>
        <button type="button" class="back-btn" (click)="goBackToEmail()">
          Change Email
        </button>
      </div>
    </ng-container>

    <!-- Step 3: Reset Password -->
    <ng-container *ngIf="currentStep === 'reset'">
      <h2>Reset Password</h2>
      <p>Enter your new password below.</p>

      <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>
      <div *ngIf="successMessage" class="success-message">{{ successMessage }}</div>

      <form (ngSubmit)="onSubmitNewPassword()" #resetForm="ngForm">
        <label for="newPassword">New Password</label>
        <input
          type="password"
          id="newPassword"
          name="newPassword"
          [(ngModel)]="newPassword"
          required
          minlength="8"
          autocomplete="new-password"
        />

        <label for="confirmPassword">Confirm Password</label>
        <input
          type="password"
          id="confirmPassword"
          name="confirmPassword"
          [(ngModel)]="confirmPassword"
          required
          autocomplete="new-password"
        />

        <div class="password-requirements">
          <small>Password must be at least 8 characters with uppercase, lowercase, digit, and special character.</small>
        </div>

        <button type="submit" [disabled]="!resetForm.form.valid || isLoading">
          {{ isLoading ? 'Resetting...' : 'Reset Password' }}
        </button>
      </form>
    </ng-container>

    <div class="create-account-section">
      <div class="divider"></div>
      <a routerLink="/signup" class="create-account-btn">CREATE ACCOUNT</a>
    </div>
  </div>
</div>
